const { read } = require("fs")



connect_server()

public_key = create_pub_key()
private_key = create_private_key()


write(public_key)

read(encrypted_answer)

answer = decrypt_async(encrypted_answer, private_key)

symmetric_key = read_symmetric_key(answer)

while(1) {
    read(command)

    encrypted_command = encrypt(command, symmetric_key)

    write(encrypted_command)

    encrypted_answer = read()

    answer = decrypt(encrypted_answer, symmetric_key)

    if(answer == user_found) {
        break
    }
    else {
        print("Wrong username or password. Try again")
    }

}

while(1) {
    command = read_keyboard_command

    add_checksum(command)

    encrypt(command, symmetric_key)

    write(command)

    while(1) {
        encrypted_answer = socket_read()

        answer = decrypt(encrypted_answer, symmetric key)

        check_result = check_sum(answer)

        if(check_result == bad_sum) {
            print(connection compromised, something is modifying your packets)
            exit()            
        }

        if(ends_with('\r\r\r', answer)) {
            remove_trail('\r\r\r', answer)
            print(answer)
            break
        }

        print(answer)
    }
}